<!DOCTYPE html>
<html>
  <head>
    <title>Kitty Litter - IntEnum for Choices in Django</title>
    <link rel="icon" href="/favicon.png" size="32x32" type="image/png">
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <header>IntEnum for Choices in Django</header>
    <nav>
        <ul>
  <li><a href="/blog/index.html">Blog</a></li>
  <li><a href="/index.html">Welcome</a></li>
</ul>

    </nav>
    <main><p>So, we've all needed a <code>choices</code> list in Django at one time or another, right?</p>

<p>And from the docs we see the example code:</p>

<pre><code>YEAR_IN_SCHOOL_CHOICES = (
    ('FR', 'Freshman'),
    ('SO', 'Sophomore'),
    ('JR', 'Junior'),
    ('SR', 'Senior'),
)
</code></pre>

<p>Which is then quickly amended to:</p>

<pre><code>class Student(models.Model):
    FRESHMAN = 'FR'
    SOPHOMORE = 'SO'
    JUNIOR = 'JR'
    SENIOR = 'SR'
    YEAR_IN_SCHOOL_CHOICES = (
        (FRESHMAN, 'Freshman'),
        (SOPHOMORE, 'Sophomore'),
        (JUNIOR, 'Junior'),
        (SENIOR, 'Senior'),
    )
    year_in_school = models.CharField(max_length=2,
                                      choices=YEAR_IN_SCHOOL_CHOICES,
                                      default=FRESHMAN)
</code></pre>

<p>Why?  Because this avoids the problem of <code>magic values</code>, an aspect of keeping DRY.</p>

<p>Magic values are constants that have meaning; they become a problem [especially with numbers] because you can't be certain if the values are coincidentally the same (i.e. this value is the 2px margin we want in common, but that one just happens to <em>also</em> be 2px...).  Much better to give them names, so we can know what the value represents, and know it's not coincidentally the same as another value.</p>

<p>It also means changing the value throughout your code can happen in once place.</p>

<p>Now the values are defined in one place, and easy to access.  Instead of having to remember to use 'JR', you can put Student.JUNIOR ; namespacing is thrown in free!</p>

<p>What's wrong with this?  Well, nothing, really... except when you have multiple choice fields on the same model.</p>

<h2>A possible solution...</h2>

<p>As of Python 3.4, we have the <a href="https://docs.python.org/3/library/enum.html">enum</a> lib.  For older Python's, there's the <code>Enum34</code> package.</p>

<p>This gives us the use <code>Enum</code> and <code>IntEnum</code> classes.</p>

<p>The above example could be rewritten as:</p>

<pre><code>class Student(models.Model):
    class YEAR(Enum):
        FRESHMAN = 'FR'
        SOHPOMORE = 'SO'
        JUNIOR = 'JR'
        SENIOR = 'SR'
</code></pre>

<p>Now we can reference the values using Student.YEAR.JUNIOR.  Not bad.</p>

<pre><code>&gt;&gt;&gt; Student.YEAR.JUNIOR
&lt;YEAR.JUNIOR: 'JR'&gt;
</code></pre>

<p>Each values provides its name and value as attributes:</p>

<pre><code>&gt;&gt;&gt; Student.YEAR.JUNIOR.name
'JUNIOR'
&gt;&gt;&gt; Student.YEAR.JUNIOR.value
'JR'
</code></pre>

<p>This helps us with our last step: to provide this in a way <code>choices=</code> will accept.</p>

<p>Fortunately, Enum <em>classes</em> are iterable:</p>

<pre><code>&gt;&gt;&gt; list(Student.YEAR)
[&lt;YEAR.FRESHMAN: 'FR'&gt;, &lt;YEAR.SOHPOMORE: 'SO'&gt;, &lt;YEAR.JUNIOR: 'JR'&gt;, &lt;YEAR.SENIOR: 'SR'&gt;]
</code></pre>

<p>So we can build choices by just:</p>

<pre><code>    year_in_school = models.CharField(max_length=2,
                                          choices=((x.value, x.name.title()) for x in YEAR),
                                          default=FRESHMAN)
</code></pre>

<h2>IntEnum</h2>

<p>When your values are all integers, there's <code>IntEnum</code>.</p>

<pre><code>class STATE(IntEnum):
    CANCELLED = -1
    PENDING = 0
    DECLINED = 1
    APPROVED = 2
</code></pre>

<p>This provides the same thing, but guarantees the values are integers.</p>

<h2>Belt and braces</h2>

<p>Finally, just to protect us from us... there's the <code>enum.unique</code> decorator.  This helps ensure that no two names have the same value.</p>

<pre><code>@enum.unique
class STATE(enum.IntEnum):
    CANCELLED = -1
    PENDING = 0
    DECLINED = 1
    APPROVED = 2
</code></pre>
</main>
    <footer> Copyright &copy; 2019 Curtis Maloney </footer>
  </body>
</html>
