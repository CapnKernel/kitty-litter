<!DOCTYPE HTML>
<!--
	Future Imperfect by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
	<title>Kitty Litter - </title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="/css/main.css" />
</head>
<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Header -->
		<header id="header">
			<h1><a href="/index.html"> <img src="/images/logo.png"> Kitty Litter</a></h1>
			<nav class="links">
				<ul>
  <li><a href="/blog/index.html">Blog</a></li>
</ul>

			</nav>
			<nav class="main">
				<ul>
					<!-- <li class="search">
						<a class="fa-search" href="#search">Search</a>
						<form id="search" method="get" action="#">
							<input type="text" name="query" placeholder="Search" />
						</form>
					</li> -->
					<li class="menu">
						<a class="fa-bars" href="#menu">Menu</a>
					</li>
				</ul>
			</nav>
		</header>

		<!-- Menu -->
		<section id="menu">
			<!-- Search -->
			<!-- <section>
				<form class="search" method="get" action="#">
					<input type="text" name="query" placeholder="Search" />
				</form>
			</section> -->

			<!-- Links -->
			<section>
				<ul class="links">
			
					<li>
						<a href="/blog/index.html">
							<h3>Blog</h3>
							<p></p>
						</a>
					</li>
			
				</ul>
			</section>

			<!-- Actions -->
			<!-- <section>
				<ul class="actions stacked">
					<li><a href="#" class="button large fit">Log In</a></li>
				</ul>
			</section> -->
		</section>

		<!-- Main -->
		<div id="main">
			
			<article class="post"><p>This comes up a lot in #django ... and the solution is [as many are with Django] much simpler than people assume.</p>

<p>Frequently I see people reach for formsets, in the mistaken conclusion that formsets are for operating on related models.  The sad part is that formsets rely on the same functionality that the proper solution relies on, but the seeker does not see it.</p>

<p>Somewhere people get the idea that for a single &lt;form&gt; submission, they can only use a single Form class... but the formset should show that that's not true; it uses multiple forms from the one submission.</p>

<h2>The answer</h2>

<p>So, as a simple example, here's a view that updates a User and their Profile in one view:</p>

<pre><code>def user_edit(request):

    if request.method == 'POST':
        user_form = UserForm(request.POST, instance=request.user)
        profile_form = ProfileForm(request.POST, instancel=request.user.profile)

        if all([user_form.is_valid(), profile_form.is_valid()]):
            user = user_form.save()
            profile = profile_form.save()
            return redirect(user)

    else:
        user_form = UserForm(instance=request.user)
        profile_form = ProfileForm(instance=request.user.profile)

    return render(request, 'accounts/user_form.html', {
        'user_form': user_form,
        'profile_form': profile_form,
    })
</code></pre>

<p>The two most significant things to notice here:</p>

<ol>
<li><p>the use of all() instead of <code>user_form.is_valid() and profile_form.is_valid()</code></p>

<p>This is because Python will "shortcut" the if clause if the first form is not valid, and so not run validation on the second form.</p>

<p>May not sound like much, but imagine how tedious it will be for your user when, after they finally get all the fields for the first form right, a whole new slew of errors who up?</p></li>
<li><p>Two forms in the context.</p>

<p>Just render them all inside the one &lt;form&gt; tag, and you're right.</p>

<p>If any of the field names clash, pass a prefix= when constructing one of the forms, to prefix its field names so they're unique.</p></li>
</ol>
</article>
			
		</div>

		<!-- Sidebar -->
		<section id="sidebar">
			<!-- Intro -->
			<section id="intro">
				<a href="/" class="logo"><img src="images/logo.jpg" alt="" /></a>
				<header>
					<h2>Updating two models in a single post</h2>
					<!-- <p>Updating two models in a single post</p> -->
				</header>
			</section>
			

			<!-- Mini Posts -->
			<section>
				<div class="mini-posts">

					<!-- Mini Post -->
					<!-- <article class="mini-post">
						<header>
							<h3><a href="single.html">Vitae sed condimentum</a></h3>
							<time class="published" datetime="2015-10-20">October 20, 2015</time>
							<a href="#" class="author"><img src="images/avatar.jpg" alt="" /></a>
						</header>
						<a href="single.html" class="image"><img src="images/pic04.jpg" alt="" /></a>
					</article> -->

				</div>
			</section>
			

			<!-- Posts List -->
			<!-- <section>
				<ul class="posts">
					<li>
						<article>
							<header>
								<h3><a href="single.html">Congue ullam corper lorem ipsum dolor</a></h3>
								<time class="published" datetime="2015-10-06">October 7, 2015</time>
							</header>
							<a href="single.html" class="image"><img src="images/pic12.jpg" alt="" /></a>
						</article>
					</li>
				</ul>
			</section> -->

			<!-- About -->
			<section class="blurb">
				<h2>About</h2>
				<p>Hi!</p>
				<p>I'm <strong>FunkyBob</strong>, also know as <small>Curtis Maloney</small>.</p>
				<p>Contained herein are some things I thought important enough to write about.</p>
				<!-- <ul class="actions">
					<li><a href="#" class="button">Learn More</a></li>
				</ul> -->
			</section>

			<!-- Footer -->
			<section id="footer">
				<ul class="icons">
					<li><a href="https://twitter.com/BunkyFob" class="fa-twitter"><span class="label">Twitter</span></a></li>
					<!-- <li><a href="#" class="fa-facebook"><span class="label">Facebook</span></a></li>
					<li><a href="#" class="fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="#" class="fa-rss"><span class="label">RSS</span></a></li>
					<li><a href="#" class="fa-envelope"><span class="label">Email</span></a></li> -->
				</ul>
				<p class="copyright">&copy; Untitled. Design: <a href="http://html5up.net">HTML5 UP</a>. Images: <a href="http://unsplash.com">Unsplash</a>.</p>
			</section>

		</section>

	</div>

	<!-- Scripts -->
	<script src="/js/jquery.min.js"></script>
	<script src="/js/browser.min.js"></script>
	<script src="/js/breakpoints.min.js"></script>
	<script src="/js/util.js"></script>
	<script src="/js/main.js"></script>

</body>
</html>
